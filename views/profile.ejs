<% include ./partials/header.ejs %>

<!-- Hidden Upload Form -->
<form
	hidden
	id="uploadform"
	action="/fileupload"
	method="post"
	enctype="multipart/form-data">
	<input
		type="file"
		name="image" />
</form>

<!-- Profile Section -->
<section class="max-w-5xl mx-auto p-4 mt-4">
	<!-- Avatar -->
	<div class="relative flex justify-center">
		<div
			class="w-32 h-32 rounded-full border-4 border-zinc-900 shadow-lg overflow-hidden">
			<img
				src="<%= user.profileimage || '/images/defaultpic.png' %>"
				alt="Avatar"
				class="w-full h-full object-cover"
				loading="lazy" />
		</div>

		<!-- Pencil Icon -->
		<button
			type="button"
			id="uploadicon"
			class="absolute bottom-2 translate-x-10 w-8 h-8 rounded-full bg-white text-zinc-800 flex items-center justify-center shadow hover:bg-zinc-200 transition">
			<i class="ri-pencil-fill text-lg"></i>
		</button>
	</div>

	<!-- Profile Info -->
	<div class="pt-6 pb-6 flex flex-col items-center text-center">
		<h1 class="text-2xl font-semibold"><%= user.fullname %></h1>
		<p class="mt-1 text-gray-400 text-sm">@<%= user.username %></p>
<div class="mt-3 flex items-center gap-6 flex-wrap justify-center text-sm text-gray-400">
  <p><span class="font-semibold text-white"><%= followersCount %></span> Followers</p>
  <p><span class="font-semibold text-white"><%= followingCount %></span> Following</p>
</div>
		<!-- Add Post Modal -->
		<div
			id="addPostModal"
			class="fixed inset-0 backdrop-blur-sm hidden flex items-center justify-center z-50 transition-opacity duration-300 opacity-0">
			<div
				class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6 transform scale-90 transition-all duration-300 relative">
				<!-- Close Button -->
				<button
					id="closeModal"
					class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 text-2xl font-bold"
					>&times;</button
				>

				<!-- Title -->
				<h2 class="text-2xl font-bold mb-5 text-gray-800 text-center"
					>âœ¨ Add New Post</h2
				>

				<!-- Upload Form -->
				<form
					action="/upload"
					method="post"
					enctype="multipart/form-data"
					class="flex flex-col gap-4">
					<input
						type="text"
						name="filetitle"
						placeholder="Write a title..."
						class="border border-gray-200 rounded-xl px-4 py-2 text-black text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500" />

					<textarea
						name="filecaption"
						placeholder="Write a caption..."
						class="border h-40 border-gray-200 rounded-xl px-4 py-2 text-sm text-black bg-gray-50 focus:ring-2 focus:ring-blue-500"></textarea>

					<span
						id="fileName"
						class="text-sm text-gray-500 italic"
						>No file chosen</span
					>
					<label
						for="fileInput"
						class="cursor-pointer flex items-center justify-center gap-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-xl font-semibold hover:bg-blue-100">
						<i class="ri-upload-cloud-2-line text-lg"></i> Choose File
					</label>
					<input
						type="file"
						id="fileInput"
						name="file"
						class="hidden" />

					<!-- Submit Button -->
					<button
						type="submit"
						class="px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition">
						Upload
					</button>
				</form>
			</div>
		</div>

		<!-- Trigger Button -->
		<div class="flex gap-3 mt-4 flex-wrap justify-center">
			<button
				id="openModal"
				class="px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-200">
				Add New Post
			</button>
		</div>
	</div>
</section>

<!-- Posts Section -->
<section class="max-w-6xl mx-auto px-6 mt-10">
	<div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
		<article
			class="shadow-sm hover:shadow-lg transition-shadow cursor-pointer"
			onclick="window.location.href='/allpins'">
			<div class="rounded-lg overflow-hidden">
				<img
					class="w-full h-48 object-cover"
					src="<%= user.posts?.[0]?.image || '/images/default-thumbnail.jpg' %>"
					alt="<%= user.posts?.[0]?.imageTitle || 'Pin Image' %>"
					loading="lazy" />
			</div>
			<div class="p-4">
				<h3 class="text-lg font-semibold text-white">Your Uploaded Pins</h3>
				<p class="text-sm text-white"><%= user.posts?.length || 0 %> pins</p>
			</div>
		</article>
	</div>
</section>

<!-- Scripts -->
<script>
	document.addEventListener('DOMContentLoaded', () => {
		const uploadIcon = document.querySelector('#uploadicon');
		const uploadInput = document.querySelector('#uploadform input');
		const modal = document.querySelector('#addPostModal');
		const modalContent = modal.querySelector('div');
		const openBtn = document.querySelector('#openModal');
		const closeBtn = document.querySelector('#closeModal');
		const fileInput = document.querySelector('#fileInput');
		const fileNameDisplay = document.querySelector('#fileName');

		// Profile Image Upload
		uploadIcon.addEventListener('click', () => uploadInput.click());
		uploadInput.addEventListener('change', () =>
			document.querySelector('#uploadform').submit(),
		);

		// File Name Display
		fileInput.addEventListener('change', () => {
			fileNameDisplay.textContent = fileInput.files.length
				? fileInput.files[0].name
				: 'No file chosen';
		});

		// Modal Open/Close
		openBtn.addEventListener('click', () => {
			modal.classList.remove('hidden', 'opacity-0');
			modalContent.classList.remove('scale-90');
		});
		closeBtn.addEventListener('click', () => {
			modal.classList.add('opacity-0');
			modalContent.classList.add('scale-90');
			setTimeout(() => modal.classList.add('hidden'), 300);
		});

		// Click Outside Modal to Close
		modal.addEventListener('click', (e) => {
			if (e.target === modal) closeBtn.click();
		});
	});
</script>

<% include ./partials/footer.ejs %>
